<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="/static/jquery-3.6.0.min.js"></script>
</head>
<body>
    <header>
        <h1 class="title">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º</h1>
    </header>
    <div class="menu">
        <ul>
            <li><a href="/">üè†–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="/results">üìà–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</a></li>
            <li><a href="/logout">üö™–í—ã–π—Ç–∏</a></li>
        </ul>
    </div>
    <p>–í—ã –≤–æ—à–ª–∏ –∫–∞–∫ {{ user.name }}</p>
    <div class="content">
        <table class="tasks">
            {% for row in tasks %}
            <tr>
                {% for task in row %}
                <td>
                    <div class="task" id={{ task.id }}>
                        <h2 class="task-title">{{ task.title }}</h2>
                        <p class="task-desc">{{ task.desc }}</p>
                        {% if task.material.all %}
                            üìé–†–∞–∑–¥–∞—Ç–æ—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:<br>
                            {% for material in task.material.all %}
                                <a href="media/{{ material.file }}">{{ material.title }}</a>
                            {% endfor %}
                            <br>
                        {% endif %}
                        {% if task.is_manual %}
                            <span>‚úã–î–∞–Ω–Ω—ã–π —Ç–∞—Å–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é</span>
                        {% else %}
                            <input id="flag_input_{{ task.id }}" type="text" placeholder="üè≥Ô∏è–§–ª–∞–≥" name="flag">
                            <hr>
                            <button id="send_flag_{{ task.id }}">‚úÖ–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                            <span id="status_{{ task.id }}"></span>
                            <script>
                                $( "#send_flag_{{ task.id }}" ).click(function() {
                                      $.post(
                                          "/send_flag/{{ task.id }}/",
                                          {"flag": $("#flag_input_{{ task.id }}").val()},
                                          onAjaxSuccess
                                        );
                            
                                        function onAjaxSuccess(data)
                                        {
                                          data_json = JSON.parse(data);
                                          if (data_json.status == 'ok') {
                                              if (data_json.response == 'correct') {
                                                $("#status_{{ task.id }}").html('–í–µ—Ä–Ω—ã–π —Ñ–ª–∞–≥!');
                                              }
                                              else {
                                                $("#status_{{ task.id }}").html('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–ª–∞–≥!');
                                              }
                                            $("#w_new_pass").html('–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å: ' + data_json.response.password);
                                            $("#w_old_pass").html('–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å: ' + data_json.response.password);
                                          }
                                          else {
                                            $("#status_{{ task.id }}").html('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ' + data_json.error);
                                          }
                                        }
                                    });
                            </script>
                        {% endif %}
                    </div>
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </table>
    </div>
</body>
</html>