<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="/static/jquery-3.6.0.min.js"></script>
</head>
<body>
    <header>
        <h1 class="title">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º</h1>
    </header>
    <div class="menu">
        <ul>
            <li><a href="/">üè†–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="/results">üìà–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</a></li>
            <li><a href="/admin">üîß–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</a></li>
            <li><a href="/logout">üö™–í—ã–π—Ç–∏</a></li>
        </ul>
    </div>
    <div class="content" align="center">
        <br>
        <div class="manual">
            <h3>‚úã–ó–∞—Å—á–∏—Ç–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é</h3>
            <label>üí°–¢–∞—Å–∫</label>
            <select id="task" name="task">
                {% for task in tasks_raw %}
                    <option value="{{task.id}}">{{ task.title }}</option>
                {% endfor %}
            </select>
            <br>
            <label>üë¶–°—Ç—É–¥–µ–Ω—Ç</label>
            <select id="student" name="student">
                {% for student in students %}
                    <option value="{{student.id}}">{{ student.name }}</option>
                {% endfor %}
            </select>
            <br>
            <button id="manual">‚úã–ó–∞—Å—á–∏—Ç–∞—Ç—å</button>

            <script>
                $( "#manual" ).click(function() {
                    $.post(
                        "/accept/manual/",
                        {"task": $( "#task" ).val(), "student": $( "#student" ).val()},
                        onAjaxSuccess
                    );
            
                    function onAjaxSuccess(data)
                    {
                        data_json = JSON.parse(data);
                        location.reload();
                    }
                });
            </script>
        </div>
        <br>
        <div class="results_admin">
            <h3>
                üìà–†–µ–∑—É–ª—å—Ç–∞—Ç—ã
                {% if message %}
                    ({{ message }})
                    <a href='/results'>–ù–∞–∑–∞–¥</a>
                {% endif %}
            </h3>
            <table border="1">
                <tr>
                    <th>üë´–ì—Ä—É–ø–ø–∞</th>
                    <th>üë¶–°—Ç—É–¥–µ–Ω—Ç</th>
                    <th>üí°–¢–∞—Å–∫</th>
                    <th>üïê–î–∞—Ç–∞ —Ä–µ—à–µ–Ω–∏—è</th>
                    <th>‚úîÔ∏è–î–∞—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è –æ—Ç—á–µ—Ç–∞</tr>
                </tr>
                {% for task in tasks %}
                    <tr>
                        <td><a href="/results/group/{{ task.student.group.id }}">{{ task.student.group.title }}</a></td>
                        <td><a href="/results/student/{{ task.student.id }}">{{ task.student.name }}</a></td>
                        <td><a href="/results/task/{{ task.task.id }}">{{ task.task.title }}</a></td>
                        <td>{{ task.date }}</td>
                        <td>
                            {% if task.date_accepted %}
                                ‚úÖ{{ task.date_accepted }}
                            {% else %}
                                ‚ùå–û—Ç—á–µ—Ç –Ω–µ –ø—Ä–∏–Ω—è—Ç <button id="accept_{{ task.id }}">‚úÖ–ü—Ä–∏–Ω—è—Ç—å?</button>
                                <script>
                                    $( "#accept_{{ task.id }}" ).click(function() {
                                        $.post(
                                            "/accept/",
                                            {"task": "{{ task.id }}"},
                                            onAjaxSuccess
                                        );
                                
                                        function onAjaxSuccess(data)
                                        {
                                            data_json = JSON.parse(data);
                                            location.reload();
                                        }
                                    });
                                </script>
                            {% endif %}
                        </td>
                    </tr>
                {% empty %}
                    –í—ã –Ω–µ —Ä–µ—à–∏–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ç–∞—Å–∫–∞...
                {% endfor %}
            </table>
        </div>
    </div>
</body>
</html>